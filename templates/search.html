{% extends "base.html" %}

{% block title %}Search{% endblock %}

{% block content %}
<h1>üîç Search Posts</h1>

<div class="alert alert-warning">
    <strong>‚ö†Ô∏è XSS Vulnerability:</strong> This search displays results without sanitization,
    but the WAF blocks XSS attacks before they reach the application.
</div>

<form method="GET" action="/search" style="margin: 30px 0;">
    <div class="form-group">
        <label for="q">Search Query:</label>
        <input type="text" id="q" name="q" value="{{ query }}" placeholder="Enter search terms...">
    </div>
    <button type="submit" class="btn btn-primary">Search</button>
</form>

{% if query %}
<h2>Search Results for: "{{ query|safe }}"</h2>

{% if results %}
<div style="margin: 20px 0;">
    {% for post in results %}
    <div style="background: #f8f9fa; padding: 20px; margin: 15px 0; border-radius: 5px;">
        <h3>{{ post[1]|safe }}</h3>
        <p>{{ post[2]|safe }}</p>
        <small>By {{ post[3] }} on {{ post[4] }}</small>
    </div>
    {% endfor %}
</div>
{% else %}
<p>No results found.</p>
{% endif %}
{% endif %}

<div style="margin: 40px 0;">
    <h3>üß™ Test XSS Payloads (All will be BLOCKED by WAF):</h3>
    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px;">
        <ul style="line-height: 2;">
            <li><code>&lt;script&gt;alert('XSS')&lt;/script&gt;</code></li>
            <li><code>&lt;img src=x onerror=alert(1)&gt;</code></li>
            <li><code>&lt;svg onload=alert('XSS')&gt;</code></li>
            <li><code>javascript:alert('XSS')</code></li>
            <li><code>&lt;iframe src="javascript:alert('XSS')"&gt;</code></li>
        </ul>
    </div>
    
    <h3 style="margin-top: 20px;">‚úÖ Safe Searches:</h3>
    <div style="background: #e8f5e9; padding: 15px; border-radius: 5px;">
        <ul style="line-height: 2;">
            <li><code>Welcome</code></li>
            <li><code>Security</code></li>
            <li><code>password</code></li>
        </ul>
    </div>
</div>

{% endblock %}
